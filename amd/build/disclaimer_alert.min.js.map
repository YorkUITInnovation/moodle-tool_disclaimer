{"version":3,"file":"disclaimer_alert.min.js","sources":["../src/disclaimer_alert.js"],"sourcesContent":["import notification from 'core/notification';\nimport ModalFactory from 'core/modal_factory';\nimport Templates from 'core/templates';\nimport ajax from 'core/ajax';\nimport config from 'core/config';\n\n/**\n * Initializes the disclaimer modal, waits for buttons, and attaches event listeners.\n * @param {Object} results - The results object containing disclaimer and user info.\n */\nexport const init = async (results) => {\n\n   var params = await fetchData(results.disclaimerid, results.userid);\n   params.objectid = results.objectid;\n\n    const modal = await ModalFactory.create({\n        title: params.subject,\n        body: Templates.render('tool_disclaimer/disclaimer_modal', params),\n        footer: Templates.render('tool_disclaimer/modal_buttons', params),\n        large: true,\n    });\n    // Prevent the modal from being dismissed when clicking outside\n    modal.getRoot().modal({\n        backdrop: 'static',\n        keyboard: false\n    });\n    modal.show();\n\n    let isModalClosing = false;\n\n    // Wait 2 seconds to activate the buttons\n    // await new Promise(resolve => setTimeout(resolve, 1000));\n\n    // Define the event handler function so we can remove it later\n    const buttonClickHandler = (event) => {\n        // Only handle clicks if modal is still open\n        if (isModalClosing) {\n            return;\n        }\n\n        // Check if the clicked element or any ancestor matches our selectors\n        if (event.target.closest('#btn-tool-disclaimer-cancel') ||\n            event.target.closest('[data-action=\"hide\"]')) {\n            respond(params.id, params.userid, 0, params.objectid, params.redirectto);\n            hideModal();\n        } else if (event.target.closest('#btn-tool-disclaimer-yes')) {\n            respond(params.id, params.userid, 1, params.objectid, '');\n            hideModal();\n        } else if (event.target.closest('#btn-tool-disclaimer-no')) {\n            respond(params.id, params.userid, 2, params.objectid, params.redirectto);\n            hideModal();\n        }\n    };\n\n    /**\n     * Hide and destroy the modal simply\n     */\n    function hideModal() {\n        if (isModalClosing) {\n            return;\n        }\n        isModalClosing = true;\n\n        // Remove the event listener to prevent multiple calls\n        document.body.removeEventListener('click', buttonClickHandler);\n\n        // Simple approach - just destroy the modal\n        modal.destroy();\n\n        // Clean up any leftover backdrop elements\n        setTimeout(() => {\n            const backdrops = document.querySelectorAll('.modal-backdrop');\n            backdrops.forEach(backdrop => backdrop.remove());\n            document.body.classList.remove('modal-open');\n            document.body.style.paddingRight = '';\n        }, 50);\n    }\n\n    // Add the event listener\n    document.body.addEventListener('click', buttonClickHandler);\n\n    // Set parameters for template\n\n\n};\n\n/**\n * Make ajax call to save the response of the user\n * @param {number} disclaimerid\n * @param {number} userid\n * @param {number} response\n * @param {number} objectid\n * @param {string} redirectto\n */\nfunction respond(disclaimerid, userid, response, objectid, redirectto = '') {\n    if (objectid === undefined) {\n        objectid = 0;\n    }\n\n    const args = {\n        userid: userid,\n        disclaimerid: disclaimerid,\n        response: response,\n        objectid: objectid\n    };\n\n    var saveResponse = ajax.call([{\n        methodname: 'tool_disclaimer_response',\n        args: args\n    }]);\n    saveResponse[0].done(function () {\n        if (redirectto) {\n            window.location.href = config.wwwroot + redirectto;\n        }\n    }).fail(function () {\n        notification.alert('Could not save response');\n    });\n}\n\n/**\n * Fetches disclaimer data for a given disclaimer and user.\n * @param {number} disclaimerid - The disclaimer ID.\n * @param {number} userid - The user ID.\n * @returns {Promise<Object>} Resolves with the disclaimer data object.\n */\nfunction fetchData (disclaimerid, userid) {\n    return new Promise((resolve, reject) => {\n        var getDisclaimer = ajax.call([{\n            methodname: 'tool_disclaimer_get_disclaimer',\n            args: {\n                id: disclaimerid\n            }\n        }]);\n        getDisclaimer[0].done(function (data) {\n            data.userid = userid;\n            resolve(data);\n        }).fail(function () {\n            notification.alert('Could not get disclaimer');\n            reject();\n        });\n    });\n}"],"names":["respond","disclaimerid","userid","response","objectid","redirectto","undefined","args","saveResponse","ajax","call","methodname","done","window","location","href","config","wwwroot","fail","alert","async","params","results","Promise","resolve","reject","id","data","modal","ModalFactory","create","title","subject","body","Templates","render","footer","large","getRoot","backdrop","keyboard","show","isModalClosing","buttonClickHandler","event","target","closest","hideModal","document","removeEventListener","destroy","setTimeout","querySelectorAll","forEach","remove","classList","style","paddingRight","addEventListener"],"mappings":"gmBA8FSA,QAAQC,aAAcC,OAAQC,SAAUC,cAAUC,kEAAa,QACnDC,IAAbF,WACAA,SAAW,SAGTG,KAAO,CACTL,OAAQA,OACRD,aAAcA,aACdE,SAAUA,SACVC,SAAUA,cAGVI,aAAeC,cAAKC,KAAK,CAAC,CAC1BC,WAAY,2BACZJ,KAAMA,QAEVC,aAAa,GAAGI,MAAK,WACbP,aACAQ,OAAOC,SAASC,KAAOC,gBAAOC,QAAUZ,eAE7Ca,MAAK,iCACSC,MAAM,4CAzGPC,MAAAA,cAmHAnB,aAAcC,OAjH3BmB,aAiHapB,aAjHYqB,QAAQrB,aAiHNC,OAjHoBoB,QAAQpB,OAkHnD,IAAIqB,SAAQ,CAACC,QAASC,UACLhB,cAAKC,KAAK,CAAC,CAC3BC,WAAY,iCACZJ,KAAM,CACFmB,GAAIzB,iBAGE,GAAGW,MAAK,SAAUe,MAC5BA,KAAKzB,OAASA,OACdsB,QAAQG,SACTT,MAAK,iCACSC,MAAM,4BACnBM,gBA7HTJ,OAAOjB,SAAWkB,QAAQlB,eAEnBwB,YAAcC,uBAAaC,OAAO,CACpCC,MAAOV,OAAOW,QACdC,KAAMC,mBAAUC,OAAO,mCAAoCd,QAC3De,OAAQF,mBAAUC,OAAO,gCAAiCd,QAC1DgB,OAAO,IAGXT,MAAMU,UAAUV,MAAM,CAClBW,SAAU,SACVC,UAAU,IAEdZ,MAAMa,WAEFC,gBAAiB,QAMfC,mBAAsBC,QAEpBF,iBAKAE,MAAMC,OAAOC,QAAQ,gCACrBF,MAAMC,OAAOC,QAAQ,yBACrB9C,QAAQqB,OAAOK,GAAIL,OAAOnB,OAAQ,EAAGmB,OAAOjB,SAAUiB,OAAOhB,YAC7D0C,aACOH,MAAMC,OAAOC,QAAQ,6BAC5B9C,QAAQqB,OAAOK,GAAIL,OAAOnB,OAAQ,EAAGmB,OAAOjB,SAAU,IACtD2C,aACOH,MAAMC,OAAOC,QAAQ,6BAC5B9C,QAAQqB,OAAOK,GAAIL,OAAOnB,OAAQ,EAAGmB,OAAOjB,SAAUiB,OAAOhB,YAC7D0C,wBAOCA,YACDL,iBAGJA,gBAAiB,EAGjBM,SAASf,KAAKgB,oBAAoB,QAASN,oBAG3Cf,MAAMsB,UAGNC,YAAW,KACWH,SAASI,iBAAiB,mBAClCC,SAAQd,UAAYA,SAASe,WACvCN,SAASf,KAAKsB,UAAUD,OAAO,cAC/BN,SAASf,KAAKuB,MAAMC,aAAe,KACpC,KAIPT,SAASf,KAAKyB,iBAAiB,QAASf"}